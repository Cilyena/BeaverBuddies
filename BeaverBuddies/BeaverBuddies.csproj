<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>netstandard2.1</TargetFramework>
		<AssemblyName>BeaverBuddies</AssemblyName>
		<Description>TimberModTest</Description>
		<Version>1.1.8</Version>
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
		<LangVersion>latest</LangVersion>
		<RunPostBuildEvent>OnBuildSuccess</RunPostBuildEvent>
		<NoWarn>$(NoWarn);Harmony003</NoWarn>
		<TimberbornPath>C:\Program Files (x86)\Steam\steamapps\common\Timberborn</TimberbornPath>
		<HarmonyPath>C:\Program Files (x86)\Steam\steamapps\workshop\content\1062090\3284904751</HarmonyPath>
		<!-- Use the registry because the doc folder can be modified outside $(USERPROFILE) like E:\DocLibrary -->
		<DocumentsPath>$(registry:HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders@Personal)</DocumentsPath>
		<BeaverBuddiesModsPath>$(DocumentsPath)\Timberborn\Mods\BeaverBuddies</BeaverBuddiesModsPath>
		<BeaverBuddiesManagedPath>$(TimberbornPath)\Timberborn_Data\Managed</BeaverBuddiesManagedPath>
	</PropertyGroup>

	<!-- NuGet -->
	<ItemGroup>		
		<PackageReference Include="BepInEx.AssemblyPublicizer" Version="0.4.2" />
		<PackageReference Include="BepInEx.AssemblyPublicizer.MSBuild" Version="0.4.2" PrivateAssets="all" />
		<!--<PackageReference Include="Lib.Harmony" Version="2.3.3" />-->
		<PackageReference Include="System.Collections.Immutable" Version="5.0.0" />
	</ItemGroup>
	<ItemGroup Condition="'$(TargetFramework.TrimEnd(`0123456789`))' == 'net'">
		<PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies" Version="1.0.2" PrivateAssets="all" />
	</ItemGroup>
	
	<!-- OutSide Project --> 
	<ItemGroup>
		<ProjectReference Include="..\TimberNet\TimberNet.csproj" />
	</ItemGroup>

	<!-- Reference DLL -->
	<ItemGroup>		
		<!-- Private Reference DLL -->
		<Reference Include="$(HarmonyPath)\0Harmony.dll" Private="false" />
		<Reference Include="$(BeaverBuddiesManagedPath)\Bindito.Core.dll" Private="false" />
		<Reference Include="$(BeaverBuddiesManagedPath)\Bindito.Unity.dll" Private="false" />
		<!-- Private Reference DLL with Publicize (use BepInEx.AssemblyPublicizer & BepInEx.AssemblyPublicizer.MSBuild) -->
		<Reference Include="$(BeaverBuddiesManagedPath)\UnityEngine.*.dll" Publicize="true" Private="false" />
		<Reference Include="$(BeaverBuddiesManagedPath)\Timberborn.*.dll" Publicize="true" Private="false" />
	</ItemGroup>

	<!-- Add file to Output folder -->
	<ItemGroup>
		<None Update="manifest.json">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
		<None Update="thumbnail.jpg">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
	</ItemGroup>

	<!-- PostBuild -->
	<Target Name="PostBuild" AfterTargets="PostBuildEvent">
		<Message Text="DestinationFolder = $(BeaverBuddiesModsPath)" />
		<!-- Create Folder -->
		<MakeDir Directories="$(BeaverBuddiesModsPath)" />
		<ItemGroup>
			<FilesToDelete Include="$(BeaverBuddiesModsPath)\*"/>
			<FilesToCopy Include="$(ProjectDir)$(OutDir)\*"/>
		</ItemGroup>
		<!-- Clear BeaverBuddiesModsPath Directory & Copy Output files inside -->
		<Delete Files="@(FilesToDelete)" />
		<Copy SourceFiles="@(FilesToCopy)" DestinationFolder="$(BeaverBuddiesModsPath)" />
	</Target>

</Project>
