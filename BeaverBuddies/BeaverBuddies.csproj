<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>netstandard2.1</TargetFramework>
		<AssemblyName>BeaverBuddies</AssemblyName>
		<Description>TimberModTest</Description>
		<Version>1.1.8</Version>
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
		<LangVersion>latest</LangVersion>
		<RunPostBuildEvent>OnBuildSuccess</RunPostBuildEvent>
		<NoWarn>$(NoWarn)</NoWarn>		
		<!-- Path Config -->
		<TimberbornPath>C:\Program Files (x86)\Steam\steamapps\common\Timberborn</TimberbornPath>
		<BepInExPath>C:\Dev\BepInEx_win_x64_5.4.23.2</BepInExPath>
		<!-- Use the registry because the doc folder can be modified outside $(USERPROFILE) like E:\DocLibrary -->
		<DocumentsPath>$(registry:HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders@Personal)</DocumentsPath>
		<BeaverBuddiesModsPath>$(DocumentsPath)\Timberborn\Mods\BeaverBuddies</BeaverBuddiesModsPath>
		<BeaverBuddiesManagedPath>$(TimberbornPath)\Timberborn_Data\Managed</BeaverBuddiesManagedPath>
		<!-- Include HarmonyX file inside $(BeaverBuddiesModsPath) -->
		<includeHarmonyX>true</includeHarmonyX>
	</PropertyGroup>

	<!-- NuGet -->
	<ItemGroup>
		<PackageReference Include="BepInEx.AssemblyPublicizer.MSBuild" Version="0.4.2" PrivateAssets="all" /> 
		<PackageReference Include="System.Collections.Immutable" Version="5.0.0" />
	</ItemGroup> 

	<!-- OutSide Project -->
	<ItemGroup>
		<ProjectReference Include="..\TimberNet\TimberNet.csproj" />
	</ItemGroup>

	<!-- Reference DLL -->
	<ItemGroup>
		<!-- BepInEx (Harmony, Mono.Cecil & MonoMod DLL) -->
		<Reference Include="$(BepInExPath)\BepInEx\core\0Harmony.dll" Private="$(includeHarmonyX)" />
		<Reference Include="$(BepInExPath)\BepInEx\core\Mono.Cecil.*.dll" Private="$(includeHarmonyX)" />
		<Reference Include="$(BepInExPath)\BepInEx\core\MonoMod.*.dll" Private="$(includeHarmonyX)" />
		
		<!-- Timberborn DLL & Publicize (BepInEx.AssemblyPublicizer.MSBuild) -->
		<Reference Include="$(BeaverBuddiesManagedPath)\Bindito.Core.dll" Private="false" />
		<Reference Include="$(BeaverBuddiesManagedPath)\Bindito.Unity.dll" Private="false" />
		<Reference Include="$(BeaverBuddiesManagedPath)\UnityEngine.*.dll" Publicize="true" Private="false" />
		<Reference Include="$(BeaverBuddiesManagedPath)\Timberborn.*.dll" Publicize="true" Private="false" />
	</ItemGroup>

	
	<!-- Add files to Output folder -->
	<ItemGroup>
		<None Update="manifest.json">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
		<None Update="thumbnail.jpg">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
	</ItemGroup>

	<!-- PreBuild -->
	<Target Name="PreBuild" BeforeTargets="PreBuildEvent">
		<!-- Empty -->
	</Target>

	<!-- PostBuild -->
	<Target Name="PostBuild" AfterTargets="PostBuildEvent">
		<Message Text="DestinationFolder = $(BeaverBuddiesModsPath)" />
		<!-- Create Folder -->
		<MakeDir Directories="$(BeaverBuddiesModsPath)" />
		<ItemGroup>
			<FilesToDelete Include="$(BeaverBuddiesModsPath)\*" />
			<FilesToCopy Include="$(ProjectDir)$(OutDir)\*" />
		</ItemGroup>
		<!-- Clear BeaverBuddiesModsPath Directory & Copy Output files inside -->
		<Delete Files="@(FilesToDelete)" />
		<Copy SourceFiles="@(FilesToCopy)" DestinationFolder="$(BeaverBuddiesModsPath)" />
	</Target>

</Project>
